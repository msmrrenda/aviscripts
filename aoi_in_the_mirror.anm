--  vim:ft=lua ff=dos fenc=sjis
--track0:flipstart,1,1000,100,1
--track1:flipend,1,10000,100,1
--track2:スコア削除,1,1000,100,1
--check0:フレーム表示,0

transition_frame = 10
option_alpha = 0
option_remove_delay = obj.track2

if(obj.frame < obj.track0) then
	option_alpha = 0
elseif(obj.frame < obj.track0 + transition_frame) then
	option_alpha = 1-(obj.track0 + transition_frame - obj.frame) / transition_frame
	debug_print(obj.track0 + transition_frame - obj.frame)
elseif(obj.frame < obj.track1 + option_remove_delay) then
	option_alpha = 1
elseif(obj.frame < obj.track1 + option_remove_delay + transition_frame) then
	option_alpha = (obj.track1 + transition_frame + option_remove_delay - obj.frame) / transition_frame
	debug_print(obj.track1 + transition_frame - obj.frame)
else
	option_alpha = 0
end



function draw_frame()
	obj.load("tempbuffer")
	obj.effect("マスク","元のサイズに合わせる",1,"type",0,"マスクの反転",0,"name",'*J:\ongeki_mask.png')
	obj.effect("回転","Z",270)
	obj.effect("拡大率","拡大率",72)
	obj.draw()
end
function draw_inner()
	rotate_y = 0
	if(obj.frame < obj.track0) then
		rotate_y = 0
	elseif(obj.frame < obj.track0 + transition_frame) then
		rotate_y = (obj.track0 + transition_frame - obj.frame) * (180/transition_frame)
	elseif(obj.frame < obj.track1) then
		rotate_y = 180
	elseif(obj.frame < obj.track1 + transition_frame) then
		rotate_y = 180 - (obj.track1 + transition_frame - obj.frame) * (180/transition_frame)
	else
		rotate_y = 0
	end
	obj.load("tempbuffer")
	obj.effect("マスク","サイズ",100,"元のサイズに合わせる",1,"マスクの反転",1,"type",0,"name",'*J:\ongeki_mask.png')
	obj.effect("回転","Y", rotate_y, "Z",270)
	obj.effect("拡大率","拡大率",72)
	obj.draw()
end

function draw_score()
	obj.load("tempbuffer")
	obj.effect("クリッピング","下",820,"左",970,"右",710,"中心の位置を変更",1)
	obj.effect("回転", "Z",270)
	obj.draw(-620,20,0,1.7,option_alpha)
end
function draw_player()
	obj.load("tempbuffer")
	obj.effect("クリッピング","左",1000,"中心の位置を変更",1)
	obj.effect("クリッピング","左",728,"下",524,"中心の位置を変更",1)
	obj.effect("回転", "Z",270)
	obj.draw(-620,-450,0,0.8)
end
function draw_music()
	obj.load("tempbuffer")
	obj.effect("クリッピング","左",1000,"中心の位置を変更",1)
	obj.effect("クリッピング","左",770,"上",786,"右",40,"中心の位置を変更",1)
	obj.effect("回転", "Z",270)
	obj.draw(-620,-300,0,1.5,option_alpha)
end

obj.setoption("drawtarget","tempbuffer",1920,1080)
obj.draw()
obj.setoption("drawtarget","framebuffer")

draw_frame()
draw_inner()
draw_score()
draw_player()
draw_music()

if( obj.check0 and not obj.getinfo("saving")) then
obj.load("text",tostring(obj.frame))
obj.setfont("Meiryo",64,0,0xffffff)
obj.draw()
end
